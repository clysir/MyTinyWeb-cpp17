# MyTinyWeb

ä¸€ä¸ªåŸºäº **Multi-Reactor æ¨¡å¼** çš„è½»é‡çº§ C++ é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨ã€‚æœ¬é¡¹ç›®æ—¨åœ¨ä»åº•å±‚ Socket ç¼–ç¨‹å¼€å§‹ï¼Œé€æ­¥æ„å»ºä¸€ä¸ªæ”¯æŒé«˜å¹¶å‘ã€å…·å¤‡ç°ä»£ C++ ç‰¹æ€§çš„ Web æœåŠ¡å™¨ã€‚

## ğŸš€ å½“å‰ç‰ˆæœ¬åŠŸèƒ½ (V4.0 - Multi-Reactor + æ—¥å¿—ç³»ç»Ÿ)

### âœ… æ–°å¢ Multi-Reactor (One Loop Per Thread)
- **EventLoopThread**ï¼šå°è£…å­çº¿ç¨‹ + EventLoop
- **EventLoopThreadPool**ï¼šçº¿ç¨‹æ± ç®¡ç†ï¼Œæ”¯æŒè½®è¯¢åˆ†é…
- **è·¨çº¿ç¨‹é€šä¿¡**ï¼š`runInLoop` + `eventfd` å”¤é†’æœºåˆ¶
- **çº¿ç¨‹å®‰å…¨è®¾è®¡**ï¼šä¸»çº¿ç¨‹ acceptï¼Œå­çº¿ç¨‹å¤„ç†è¯»å†™

### âœ… æ–°å¢åŒæ­¥æ—¥å¿—ç³»ç»Ÿ
- **LogLevel**ï¼šDEBUG / INFO / WARN / ERROR / FATAL äº”çº§
- **LogStream**ï¼šæµå¼ APIï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
- **Logger**ï¼šè‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ã€æ–‡ä»¶åã€è¡Œå·

### âœ… æ€§èƒ½è¡¨ç°
| å¹¶å‘æ•° | QPS | å»¶è¿Ÿ |
|--------|-----|------|
| 100 | 3,700 | 38ms |
| 200 | **4,200** | 42ms |
| 500 | 3,800 | 98ms |

*æµ‹è¯•ç¯å¢ƒï¼šWSL2ï¼Œwrk å‹æµ‹*

### âœ… HTTP æ¨¡å—
- **HttpRequest**ï¼šå­˜å‚¨ HTTP è¯·æ±‚ä¿¡æ¯
- **HttpResponse**ï¼šæ„å»º HTTP å“åº”
- **HttpContext**ï¼šçŠ¶æ€æœºè§£æå™¨ï¼Œç»‘å®šåˆ°æ¯ä¸ªè¿æ¥
- **HttpServer**ï¼šHTTP æœåŠ¡å™¨å°è£…

### âœ… æ ¸å¿ƒç»„ä»¶
- **Socket**ï¼šRAII å°è£…
- **Epoll**ï¼šä½¿ç”¨ `std::vector` åŠ¨æ€ç®¡ç†äº‹ä»¶
- **Channel**ï¼šäº‹ä»¶åˆ†å‘å™¨
- **Buffer**ï¼šåŒæ¸¸æ ‡è®¾è®¡ï¼Œæ”¯æŒ `readv` é«˜æ€§èƒ½è¯»å–
- **TcpConnection**ï¼šè¿æ¥ç®¡ç†å™¨ + ç§æœ‰ Context
- **EventLoop**ï¼šäº‹ä»¶å¾ªç¯æ ¸å¿ƒ + è·¨çº¿ç¨‹ä»»åŠ¡é˜Ÿåˆ—
- **Server**ï¼šæœåŠ¡å™¨å…¥å£ + çº¿ç¨‹æ± 

### âœ… ç°ä»£ C++17 ç‰¹æ€§
- `std::unique_ptr` / `std::shared_ptr` æ™ºèƒ½æŒ‡é’ˆ
- `std::string_view` é›¶æ‹·è´å­—ç¬¦ä¸²è§†å›¾
- `std::any` ç±»å‹æ“¦é™¤å­˜å‚¨ Context
- `std::function` + Lambda å›è°ƒ
- `std::condition_variable` çº¿ç¨‹åŒæ­¥

## ğŸ—ï¸ Multi-Reactor æ¶æ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Main Thread    â”‚
                    â”‚   (accept only)  â”‚
                    â”‚    EventLoop     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ dispatch
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IO Thread 1   â”‚ â”‚   IO Thread 2   â”‚ â”‚   IO Thread 3   â”‚
â”‚   EventLoop     â”‚ â”‚   EventLoop     â”‚ â”‚   EventLoop     â”‚
â”‚  Client 0,3,6   â”‚ â”‚  Client 1,4,7   â”‚ â”‚  Client 2,5,8   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ å¦‚ä½•ç¼–è¯‘ä¸è¿è¡Œ

### ä¾èµ–ç¯å¢ƒ
- Linux ç³»ç»Ÿ (Epoll)
- CMake (3.10+)
- C++17 ç¼–è¯‘å™¨ (GCC 7+)

### ç¼–è¯‘æ­¥éª¤
```bash
cd tests
mkdir build && cd build
cmake ..
make
```

### è¿è¡ŒæœåŠ¡å™¨
```bash
cd ~/MyTinyWeb
./tests/build/http_web
```

### å‹åŠ›æµ‹è¯•
```bash
# å®‰è£… wrk
sudo apt install wrk

# æµ‹è¯•
wrk -t4 -c200 -d10s http://127.0.0.1:8008/
```

## ğŸ“… ç‰ˆæœ¬å†å²

- **V4.0**: Multi-Reactor + åŒæ­¥æ—¥å¿—ç³»ç»Ÿ
- **V3.0**: é™æ€æ–‡ä»¶æœåŠ¡
- **V2.5**: HTTP åè®®æ”¯æŒ
- **V2.0**: TcpConnection å°è£…
- **V1.0**: åŸºç¡€ Reactor æ¨¡å¼

## ğŸ“… ä¸‹ä¸€æ­¥è®¡åˆ’
- [ ] å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿï¼ˆåŒç¼“å†²ï¼‰
- [ ] å®šæ—¶å™¨ Timer æ”¯æŒ
- [ ] POST è¯·æ±‚è§£æ
- [ ] è¿æ¥æ± 

---
*Created by [chenly](https://github.com/chenly)*
